---

# Handle the single task from the recommendation

- debug: var=task

# Once the task was executed before (weight is zero)
# Update the varialbe excuted_tasks as skip task 
- name: update execution history
  set_fact:
    excuted_tasks: "{{ excuted_tasks + [ 'skip executed task : ' +  task.strip().split('-')[0]  ] }}"
  when: task.strip().split('-')[2].split(':')[1] == '0'

- debug: var=excuted_tasks
  when: task.strip().split('-')[2].split(':')[1] == '0'


- name: Execute new task 
  block:
    - set_fact:
        task_name: "{{  task.strip().split('-')[0] }}"
  
    - set_fact:
        task_result: "{{  tasks_results[task_name] }}"  
    
    - set_fact:
        task_status: "Task: {{ task_name }} --- Expected Return Code: {{ task.strip().split('-')[1] }} --- Actual Return Code: {{ task_result }}"

    - debug: var=task_status

    - name: update execution history
      set_fact:
        excuted_tasks: "{{ excuted_tasks + [  task_status ] }}"

    - debug: var=task_status

    - name: when task result is expected
      include_tasks: task-not-as-expected.yaml
 
    - name: when task result is not expected
      include_tasks: task-as-expected.yaml
  
  when: task.strip().split('-')[2].split(':')[1] != '0'

